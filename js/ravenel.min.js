if("undefined"==typeof jQuery)throw new Error("Henry William Ravenel requires jQuery");!function(e){"use strict";function t(e){return this.each(function(){new n})}var i,n=function(){this.addListeners()};n.prototype.addListeners=function(){var t=this;e("#feedback").on("submit",function(n){i={url:window.location.href,name:e(this).find('[name="name"]').val().trim(),email:e(this).find('[name="email"]').val().trim(),message:e(this).find('[name="message"]').val().trim(),category:e(this).find('[name="category"]').val(),platform:platform.description,response:grecaptcha.getResponse()},t.validate()&&t.send(),n.target.blur(),n.preventDefault()})},n.prototype.validate=function(){if(null===i||void 0===i)return!1;for(var e=["name","email","category","message","response"],t=0;t<e.length;t++)if(!i.hasOwnProperty(e[t]))return"response"===e[t]?this.notify("danger","There was an error adding the reCAPTCHA response. Please try again."):this.notify("danger","There was an error adding the "+e[t]+" field. Please try again."),!1;return""===i.name?(this.notify("warning","Please input a name"),!1):50<i.name.length?(this.notify("warning","Please input a name with less than 50 characters."),!1):""===i.email?(this.notify("warning","Please input an email."),!1):100<i.email.length?(this.notify("warning","Please input an email with less than 100 characters."),!1):i.email.match(/\S+@\S+/)?""===i.category?(this.notify("warning","Please select a category."),!1):"general"!==i.category&&"manuscripts"!==i.category&&"specimens"!==i.category?(this.notify("danger","Please do not alter the values of the category selection."),!1):""===i.message?(this.notify("warning","Please input a message."),!1):300<i.message.length?(this.notify("warning","Please input a message with less than 300 characters."),!1):""===i.response?(this.notify("warning","Please validate the reCAPTCHA."),!1):!0:(this.notify("warning","Please input a valid email."),!1)},n.prototype.notify=function(t,i){e("#feedback").prev().is(".alert")?e("#feedback").prev().removeClass("alert-danger alert-info alert-success alert-warning").addClass("alert-"+t).html("<p>"+i+"</p>").parent().slideDown():e('<div class="alert alert-'+t+'"><p>'+i+"</p></div>").insertBefore(e("#feedback"))},n.prototype.send=function(){var t=this;e.ajax({url:window.location.href,type:"POST",data:{data:i},success:function(e){var i=JSON.parse(e);t.notify(i.status,i.text),"success"===i.status&&t.empty()},error:function(e){t.nofity("danger",e.responseText)}})},n.prototype.empty=function(){i=null,grecaptcha.reset(),e("#feedback .form-control").val("")},e.fn.mail=t,e.fn.mail.Constructor=n}(jQuery),function(e){"use strict";function t(e){return this.each(function(){new i})}var i=function(){this.addListeners()};i.prototype.addListeners=function(){e(".browse-column").on("click","button",function(t){e(this).next().is(":visible")?e(this).next().slideUp("fast"):e(this).parent().find(".list-group:visible").length?(e(this).parent().find(".list-group:visible").prev().css("border-bottom-width","").next().slideUp("fast"),e(this).next().slideDown("fast")):e(this).next().slideDown("fast"),t.target.blur()})},e.fn.browse=t,e.fn.browse.Constructor=i}(jQuery),function(e){"use strict";function t(t){return this.each(function(){new i(0===e("[data-step]").length)})}var i=function(t){t?(this.initializeTable(e("#journals > table")),this.initializeTable(e("#letters > table")),this.initializeTable(e("#specimens > table")),e.ajax({url:"includes/search-results?type=photographs&"+window.location.search.substring(1),dataType:"json",success:function(t){e("#photographs").html(t.images),e('.search-tabs a[href="#photographs"]').parent().removeClass("disabled").find("span > span").text(t.images.length).counter()}})):(this.initializeTour(),this.addListeners())};i.prototype.initializeTour=function(){var t=[];e("[data-step]").each(function(){t.push(new Object({element:e(this),title:e(this).data("step-title"),content:e(this).data("step-content"),placement:e(this).data("step-placement")}))});var i=new Tour({steps:t,backdrop:!0});i.init(),e("#tourStart").on("click",function(e){i.restart(),e.target.blur()})},i.prototype.initializeTable=function(t){var i,n=t.parent().attr("id");"journals"===n?i=[{data:"pointer"},{data:"date"},{data:"people"},{data:"geogra"},{data:"transc"},{data:"scient"},{data:"common"},{data:"title"},{data:"lattit"},{data:"descri"}]:"letters"===n?i=[{data:"pointer"},{data:"date"},{data:"people"},{data:"title"},{data:"geogra"},{data:"descri"},{data:"scient"},{data:"common"},{data:"lattit"},{data:"transc"}]:"specimens"===n&&(i=[{data:"thumbnailurl"},{data:"scientificName"},{data:"eventDate"},{data:"identifiedBy"},{data:"location"},{data:"coordinates"},{data:"habitat"},{data:"recordedBy"},{data:"cultivationStatus"}]);var a=t.DataTable({processing:!0,ajax:"includes/search-results?type="+n+"&"+window.location.search.substring(1),filter:!1,lengthChange:!0,autoWidth:!0,scrollY:"50vh",columns:i,columnDefs:[{targets:this.getColumnTargets(t),visible:!1}],initComplete:function(){e('.search-tabs a[href="#'+n+'"]').parent().removeClass("disabled").find("span > span").text(a.data().count()).counter(),"journals"!==n&&e("#"+n).css({position:"",display:"","pointer-events":""}),e("#"+n+' > [data-toggle="columns"]').on("click","li > a",function(t){var i=a.column(e(this).attr("data-column"));i.visible(!i.visible()),e(this).toggleClass("is-visible is-not-visible"),t.target.blur(),t.preventDefault()})}})},i.prototype.addListeners=function(){e("#addAdvancedRow").on("click",function(t){if(7!==e("#advancedForm .form-group").length){var i=e('#advancedForm select[name="operators[]"]').last().parent().clone();i.find("select").val("and"),e(i).insertAfter(e('#advancedForm input[name="input[]"]').last().parent());var n=e('#advancedForm select[name="options[]"]').last().parent().clone();n.find("select").val("CISOSEARCHALL");var a=e('#advancedForm input[name="input[]"]').last().parent().clone();a.find("input").val(""),e('<div class="form-group">'+n.get(0).outerHTML+a.get(0).outerHTML+"</div>").insertBefore(e("#advancedForm > fieldset > .clearfix")),7===e("#advancedForm .form-group").length&&e(this).remove()}}),e("#basicSearch").on("keyup",function(t){e("#basicLive").text(""===e(this).val().trim()?"":"Search everything for "+e(this).val().trim().replace(/ /g," and "))}),e("#advancedForm").on("change keyup","input, select",function(){var t="Searching",i=[],n=[],a=[];e("#advancedForm .form-control").each(function(){if(e(this).is("input")){if(""===e(this).val().trim())return!0;i.push(e(this).val().trim())}else"options[]"===e(this).prop("name")?a.push("All Fields"===e(this).find(":selected").text()?"everything":e(this).find(":selected").text()):n.push(e(this).find(":selected").text())});for(var r=0;r<i.length;r++)0!==r&&(t+=" "+n[r-1].toLowerCase()),t+=" "+a[r]+" for "+i[r];e("#advancedLive").text(t)}),e("#advancedForm").on("submit",function(t){e("#advancedForm .form-group:not(.clearfix)").each(function(){""===e(this).find("input").val().trim()&&(e(this).prev().find('select[name="operators[]"]').parent().remove(),e(this).remove())})})},i.prototype.getColumnTargets=function(e){for(var t=[],i=5;i<e.find("thead > tr > th").length;i++)t.push(i);return t},e.fn.search=t,e.fn.search.Constructor=i}(jQuery),function(e){"use strict";function t(e){return this.each(function(){new i})}var i=function(){if(e("#mainViewer").css("height",e(".panel-reading").height()),this.addListeners(),document.title.indexOf("Manuscript Viewer")>-1)this.addManuscriptListeners();else{if(!(document.title.indexOf("Specimen Viewer")>-1))throw new Error("Error in determing type of viewer. Possible problem: Title is not typed properly.");this.addSpecimenListeners()}setTimeout(function(){e("#mainImage").hasClass("ui-draggable")||e("#mainImage").load()},800)};i.prototype.addListeners=function(){e(".row").on("click",".panel-viewer .zoom-plus",function(t){var i=e(this).parentsUntil(".panel-viewer").parent().find("> img"),n=1.2*i.innerWidth();i.css("max-width",n),setTimeout(function(){i.parent().find(".thumbnail-overlay").css({height:i.parent().innerHeight()/i.innerHeight()*100+"%","max-width":i.parent().innerWidth()/n*100+"%"})},100),i.attr("data-width")*(5/3)<n&&e(this).addClass("disabled"),e(this).parentsUntil(".panel-tools").find(".zoom-minus, .refresh").removeClass("disabled"),t.target.blur(),t.preventDefault()}),e(".row").on("click",".panel-viewer .zoom-minus",function(t){var i=e(this).parentsUntil(".panel-viewer").parent().find("> img"),n=.8*i.innerWidth();i.css("max-width",n),setTimeout(function(){i.parent().find(".thumbnail-overlay").css({height:i.parent().innerHeight()/i.innerHeight()*100+"%","max-width":i.parent().innerWidth()/n*100+"%"})},100),n<i.attr("data-width")*(1/3)&&e(this).addClass("disabled"),e(this).parentsUntil(".panel-tools").find(".zoom-plus, .refresh").removeClass("disabled"),t.target.blur(),t.preventDefault()}),e(".row").on("click",".panel-viewer .refresh",function(t){var i=e(this).parentsUntil(".panel-viewer").parent().find("> img");i.css({top:0,left:0,"max-width":"100%"}),setTimeout(function(){i.parent().find(".thumbnail-overlay").css({top:0,left:0,height:i.parent().innerHeight()/i.innerHeight()*100+"%","max-width":"100%"})},100),e(this).addClass("disabled").parentsUntil(".panel-tools").find(".zoom-plus, .zoom-minus").removeClass("disabled"),t.target.blur(),t.preventDefault()}),e(".row").on("mousemove",".panel-viewer > img",function(t){1==t.which&&e(this).parent().find(".thumbnail-overlay").css({top:e(this).position().top*(e(this).parent().find(".panel-thumbnail").height()/e(this).height())*-1,left:e(this).position().left*(e(this).parent().find(".panel-thumbnail").width()/e(this).width())*-1}),e(this).parent().find(".refresh").removeClass("disabled")}),e("#mainImage").on("load",function(){e(this).overlay().draggable().parent().resizable({handles:"e",minWidth:340,maxWidth:.6*e(window).width()}).find(".ui-resizable-e").html('<i class="fa fa-chevron-left"></i><i class="fa fa-chevron-right"></i>'),e(this).attr("data-width",e(this).innerWidth()),e("#mainViewer .image-loading-icon").fadeOut()}),e("#mainViewer").on("resize",function(){e(".panel-reading").css({width:e(this).parent().width()-e(this).width()-30,height:e(this).height()}),e(this).find(".thumbnail-overlay").css({height:e(this).height()/e(this).find("> img").height()*100+"%","max-width":e(this).width()/e(this).find("> img").width()*100+"%"})})},i.prototype.addManuscriptListeners=function(){var t=this;e("#mainViewer").on("resizecreate",function(){e(".viewer-specimen").addClass("viewer-specimen-ready")}),e(".viewer-specimen").on("click",function(){(void 0!==e("#mainViewer").resizable("instance")||0!==e("#specimenSideViewer").length)&&(0===e("#specimenSideViewer").length&&t.rearrange(),t.getData({catalogNumber:e(this).data("catalog")},function(e){var i=JSON.parse(e);t.renderSide(i.image,i.metadata,"specimen"),t.reinitialize()}))})},i.prototype.addSpecimenListeners=function(){var t=this;e("#specimenJournalMentions .text-center").on("click",function(){e(this).css("outline","none"),(void 0!==e("#mainViewer").resizable("instance")||0!==e("#manuscriptSideViewer").length)&&(0===e("#manuscriptSideViewer").length&&t.rearrange(),t.getData({pointer:e(this).data("pointer"),institute:e(this).data("institute")},function(e){var i=JSON.parse(e);t.renderSide(i.image,i.metadata,"manuscript"),t.reinitialize()}))})},i.prototype.rearrange=function(){e("#specimenSideViewer").length||e("#manuscriptSideViewer").length||(e("#mainViewer").addClass("width-transition").css("width","").removeClass("width-transition"),e(".panel-reading").hide(),e(".panel-reading pre").length&&(e('<li class="list-group-item" data-field="transc"><h4 class="list-group-item-heading">Transcript</h4>'+e(".panel-reading .panel-content").html()+"</li>").insertAfter(e("#viewerMetadata > ul > li:nth-child(4)")),e("#toggleRightPanel").show()),e("#specimenJournalMentions").length&&e('<hr><div class="row"><div class="col-sm-6" id="specimenData">'+e(".panel-reading .panel-content").html()+"</div></div>").insertBefore(e(".container > hr")),e("#mainViewer").resizable("destroy"))},i.prototype.reinitialize=function(){e('[data-toggle="tooltip"]').tooltip(),e(".fb").fancybox({type:"image",beforeLoad:function(){this.title=this.element.parentsUntil(".panel-viewer").parent().find("> img").prop("alt")}})},i.prototype.renderSide=function(t,i,n){if(0===e("#"+n+"SideViewer").length)if(e(e(t)).insertAfter(e(".panel-reading")),"manuscript"===n)e(e(i)).insertAfter(e("#specimenData"));else{if("specimen"!==n)throw new Error('Improper type "'+n+'" discovered while rendering.');e(e(i)).insertAfter(e("#viewerMetadata"))}else e("#"+n+"Data").get(0).outerHTML=i,e("#"+n+"SideViewer").get(0).outerHTML=t;e("#"+n+"Data").fadeIn(),e("#"+n+"SideViewer").css("height","50px").addClass("height-transition").css("height",e("#mainViewer").height()).fadeIn(function(){e(this).find("> img").overlay().draggable()}),"manuscript"===n&&e("#manuscriptSideViewer > img").on("load",function(){e(this).overlay()})},i.prototype.getData=function(t,i){e.ajax({url:"http://ravenel.cdh.sc.edu/viewer",type:"GET",data:t,success:i,error:function(e){throw new Error(e.responseText)}})},e.fn.viewer=t,e.fn.viewer.Constructor=i}(jQuery),$.fn.extend({counter:function(){return this.each(function(){var e=this;jQuery({Counter:0}).animate({Counter:e.innerText},{duration:1200,easing:"swing",step:function(){e.innerHTML=Math.ceil(this.Counter)}})})},overlay:function(){return this.each(function(){$(this).parent().find(".thumbnail-overlay").css({height:$(this).parent().height()/$(this).height()*100+"%"})})}}),document.title.indexOf("Browse")>-1?$(document).browse():document.title.indexOf("Search")>-1?$(document).search():document.title.indexOf("Viewer")>-1?$(document).viewer():document.title.indexOf("Portraits")>-1&&$("#gallery").unitegallery({theme_enable_preloader:!0,theme_preloading_height:200,gallery_theme:"tiles",gallery_width:"100%",gallery_min_width:150,tiles_space_between_cols:20,tiles_col_width:220,tile_enable_shadow:!0,tile_enable_textpanel:!0}),$(document).ready(function(){$("#submit-search").on("submit",function(e){""===$(this).find("input").val().trim()&&e.preventDefault()}),$("#search").on("click",function(e){e.target.blur(),$("header form").is(":visible")?$("header form").fadeOut("fast"):$("header form").fadeIn(function(){$(this).find("input").focus()}),e.preventDefault()}),$(".alert").on("click","button.close",function(e){$(this).parent().slideUp()}),$('[data-toggle="tooltip"]').tooltip(),$('[data-effect="fancybox"]').fancybox({type:"image",beforeLoad:function(){this.title=this.element.parentsUntil(".panel-viewer").parent().find("> img").prop("alt")}}),$('[data-effect="slick"][data-slick="on"]').slick({dots:!0,infinite:!0,slidesToShow:$('[data-effect="slick"][data-slick="on"]').data("slick-amount"),slidesToScroll:$('[data-effect="slick"][data-slick="on"]').data("slick-amount")}),$('[data-effect="count"]').counter(),$(document).mail(),"IE"===platform.name&&parseFloat(platform.version)<10?$("#alertBrowser p").text("Your browser, Internet Explorer, version "+platform.version+" is not recommended to view this website. Please upgrade to at least version 10 or switch to another browser.").parent().removeClass("hide"):"Opera"===platform.name&&parseFloat(platform.version)<15?$("#alertBrowser p").text("Your browser, Opera, version "+platform.version+" is not recommended to view this website. Please upgrade to at least version 15 or switch to another browser.").parent().removeClass("hide"):"Safari"===platform.name&&parseFloat(platform.version)<5.1&&$("#alertBrowser p").text("Your browser, Safari, version "+platform.version+" is not recommended to view this website. Please upgrade to at least version 5.1 or switch to another browser.").parent().removeClass("hide")});
